# 반복 문장 제거 기능 가이드 (v2.5)

## 🎯 개요

PDF 변환 시 반복되는 문장(회사명, 책 제목, 저작권 정보 등)을 자동으로 제거하는 기능입니다.

### 문제 상황
```
PDF 내용:
페이지 1: "흐르는 강물처럼 - 문학사 - 본문 내용..."
페이지 2: "흐르는 강물처럼 - 문학사 - 본문 내용..."
페이지 3: "흐르는 강물처럼 - 문학사 - 본문 내용..."
...

기존 MP3:
"흐르는 강물처럼, 문학사, 본문 내용, 흐르는 강물처럼, 문학사, 본문 내용..."
→ 반복 문장이 계속 읽혀서 듣기 불편
```

### 해결 방법
`ignores.txt` 파일에 제거할 문장을 등록하면 자동으로 삭제됩니다.

---

## 🚀 사용 방법

### 1단계: ignores.txt 파일 생성

프로그램 실행 디렉토리에 `ignores.txt` 파일을 만듭니다.

```bash
cd ~/work/MeloTTS
nano ignores.txt  # 또는 vi, vim 등 편집기 사용
```

### 2단계: 제거할 문장 입력

한 줄에 하나씩 제거할 문장을 입력합니다.

**ignores.txt 예시:**
```
흐르는 강물처럼
문학사
저작권 © 2024
All Rights Reserved
페이지
Chapter
```

### 3단계: PDF 변환 실행

일반적인 방법과 동일하게 실행합니다.

```bash
# 단일 파일
./run_pdf2mp3.sh document.pdf

# 배치 변환
./run_pdf2mp3.sh ./pdf
```

### 4단계: 결과 확인

콘솔 출력에서 제거된 문장 수를 확인할 수 있습니다.

**출력 예시:**
```
============================================================
[2단계] 텍스트 전처리 및 분할
============================================================

📝 제외 패턴 목록 (ignores.txt):
------------------------------------------------------------
  1. '흐르는 강물처럼'
  2. '문학사'
  3. '저작권 © 2024'
------------------------------------------------------------
총 3개 패턴 적용

🗑️  제거된 반복 문장:
------------------------------------------------------------
  • '흐르는 강물처럼': 15회 제거
  • '문학사': 12회 제거
  • '저작권 © 2024': 8회 제거
------------------------------------------------------------
✓ 총 35개 반복 문장 제거됨

📊 텍스트 청크 분할 중...
✓ 총 41개의 청크로 분할되었습니다.
```

---

## 📝 ignores.txt 작성 규칙

### 기본 규칙

1. **한 줄에 하나씩**: 각 문장은 별도의 줄에 입력
2. **주석 사용 가능**: `#`으로 시작하는 줄은 무시
3. **빈 줄 무시**: 빈 줄은 자동으로 무시
4. **대소문자 무관**: 대소문자 구분 없이 매칭
5. **공백 무시**: 앞뒤 공백은 자동으로 무시

### 작성 예시

```txt
# 책 제목 및 출판사
흐르는 강물처럼
문학사
도서출판 예림

# 저작권 정보
저작권
Copyright
All Rights Reserved
© 2024

# 페이지 번호 관련
페이지
Page
p.

# 챕터 표시
Chapter
제1장
제2장

# 기타 반복 문장
ISBN
본 저작물은
무단 전재를 금합니다
```

---

## 💡 실전 예시

### 예시 1: 소설책 변환

**PDF 내용:**
```
흐르는 강물처럼
문학사

첫 번째 장면입니다...

---

흐르는 강물처럼
문학사

두 번째 장면입니다...
```

**ignores.txt:**
```
흐르는 강물처럼
문학사
```

**결과 MP3:**
```
"첫 번째 장면입니다... 두 번째 장면입니다..."
→ 반복 문장 제거됨 ✅
```

### 예시 2: 비즈니스 문서

**PDF 내용:**
```
ABC 주식회사
기밀 문서

1분기 보고서...

---

ABC 주식회사
기밀 문서

2분기 보고서...
```

**ignores.txt:**
```
ABC 주식회사
기밀 문서
Confidential
```

**결과 MP3:**
```
"1분기 보고서... 2분기 보고서..."
→ 회사명과 기밀 표시 제거됨 ✅
```

### 예시 3: 학술 논문

**PDF 내용:**
```
Journal of Science
Vol. 25, No. 3
Page 123

논문 본문...
```

**ignores.txt:**
```
Journal of Science
Vol.
Page
```

**결과 MP3:**
```
"논문 본문..."
→ 저널명, 권호, 페이지 번호 제거됨 ✅
```

---

## 🔧 고급 사용법

### 1. 폴더별 다른 ignores.txt 사용

각 폴더에 별도의 `ignores.txt`를 배치하면 자동으로 해당 파일 사용:

```
project/
├── novels/
│   ├── ignores.txt  ← 소설용 패턴
│   └── book1.pdf
└── reports/
    ├── ignores.txt  ← 보고서용 패턴
    └── report1.pdf
```

배치 변환 시 각 폴더의 `ignores.txt`를 자동으로 찾아 적용합니다.

### 2. 정규식처럼 사용하기

현재는 완전 일치만 지원하지만, 여러 변형을 등록할 수 있습니다:

```txt
# 페이지 번호의 다양한 형태
페이지 1
페이지 2
페이지 3
Page 1
Page 2
P. 1
P. 2
```

### 3. 파일별 맞춤 설정

특정 파일에만 적용하고 싶으면 해당 파일과 같은 디렉토리에서 실행:

```bash
cd ~/work/MeloTTS/special_docs
# 이 폴더의 ignores.txt 사용
python ../pdf2mp3.py document.pdf
```

---

## 🐛 문제 해결

### 문제 1: 패턴이 제거되지 않음

**원인**: 정확히 일치하지 않음

**해결**:
1. PDF에서 실제 텍스트 확인:
   ```bash
   python -c "import fitz; print(fitz.open('file.pdf')[0].get_text())"
   ```
2. 공백, 특수문자 확인
3. ignores.txt에 정확히 입력

### 문제 2: 필요한 내용까지 제거됨

**원인**: 패턴이 너무 짧거나 일반적

**해결**:
- 더 구체적인 패턴 사용
- 예: "Page" → "Page | 문학사" (더 길고 구체적)

### 문제 3: ignores.txt가 적용 안 됨

**확인 사항**:
1. 파일명이 정확한지 확인: `ignores.txt` (소문자)
2. 파일이 실행 디렉토리에 있는지 확인
3. 파일 인코딩이 UTF-8인지 확인

```bash
# 파일 확인
ls -la ignores.txt

# 인코딩 확인
file ignores.txt
```

---

## 📊 성능 영향

### 처리 시간
- 패턴 제거는 매우 빠릅니다 (밀리초 단위)
- 전체 변환 시간에 영향 거의 없음

### 메모리 사용
- 추가 메모리 사용량: 무시할 수 있는 수준
- 기존 메모리 관리와 동일하게 안정적

### 로그 영향
- 패턴 제거 정보가 로그에 기록됨
- 디버그 모드에서는 각 패턴별 제거 횟수 기록

---

## 📋 체크리스트

### 설정 전
- [ ] `ignores.txt` 파일 생성
- [ ] 제거할 문장 목록 작성
- [ ] 파일 인코딩 UTF-8 확인
- [ ] 실행 디렉토리에 파일 배치

### 실행 시
- [ ] 콘솔에서 "ignores.txt 적용" 메시지 확인
- [ ] 제거된 문장 수 확인
- [ ] 로그에서 세부 정보 확인

### 실행 후
- [ ] 생성된 MP3 청취 테스트
- [ ] 필요한 내용이 제거되지 않았는지 확인
- [ ] 반복 문장이 제거되었는지 확인

---

## 🎓 Best Practices

### 1. 테스트 먼저
첫 번째 파일로 테스트 후 배치 처리:
```bash
# 테스트
python pdf2mp3.py test.pdf

# MP3 확인 후 배치
./run_pdf2mp3.sh ./pdf
```

### 2. 백업 보관
원본 PDF는 항상 보관:
```bash
cp -r pdf/ pdf_backup/
```

### 3. 점진적 추가
처음에는 확실한 패턴만 추가:
```txt
# 1차: 확실한 것만
책제목
출판사명

# 2차: 테스트 후 추가
# 챕터 번호
# 페이지 번호
```

### 4. 주석 활용
나중에 이해하기 쉽도록 주석 작성:
```txt
# 2024-02-15 추가: 저작권 정보
Copyright
All Rights Reserved

# 2024-02-16 추가: 페이지 관련
Page
페이지
```

---

## 🆕 v2.5 신규 기능

### 반복 문장 자동 제거
✅ `ignores.txt` 파일로 간편 관리  
✅ 대소문자 구분 없이 매칭  
✅ 공백 무시 자동 처리  
✅ 제거 통계 실시간 표시  
✅ 로그에 상세 정보 기록  
✅ 기존 기능과 완벽 호환  

### 하위 호환성
✅ `ignores.txt` 없으면 기존처럼 작동  
✅ 기존 설정/명령어 변경 없음  
✅ 배치 처리와 완벽 호환  

---

## 명령어 요약

```bash
# ignores.txt 파일 생성
nano ignores.txt

# 단일 파일 변환
./run_pdf2mp3.sh document.pdf

# 배치 변환
./run_pdf2mp3.sh ./pdf

# 로그 확인
grep "반복 문장" pdf2mp3.log
grep "ignores.txt" pdf2mp3.log
```

---

## 버전 정보
- **v2.5** (2026-02-15) - 반복 문장 제거 기능 추가
- **v2.4** (2026-02-14) - 배치 변환 기능
- **v2.3** (2026-02-13) - 상세 로깅 기능

## GitHub
https://github.com/nillili/MeloTTS

---

**Tip**: 첫 실행 시 `ignores.txt`에 1-2개 패턴만 넣고 테스트해보세요!
