# 🚀 빠른 시작 가이드

## ✅ 최종 수정 완료! (v2.2.1)

**문제 해결**: `run_pdf2mp3.sh` 스크립트가 이제 Conda 환경의 Python을 정확하게 사용합니다!

---

## 📋 실행 방법 (3단계만!)

### 1단계: 최신 코드 가져오기

```bash
cd ~/work/MeloTTS
git pull origin main
```

### 2단계: Conda 환경 활성화 ⭐ **필수!**

```bash
conda activate melo
```

### 3단계: 실행!

```bash
./run_pdf2mp3.sh 열세번째1.pdf
```

---

## 🎯 실행 시 보이는 화면

```bash
$ conda activate melo
$ ./run_pdf2mp3.sh 열세번째1.pdf

✓ Conda 환경 감지: melo
============================================================
PDF2MP3 메모리 최적화 모드로 실행
============================================================
환경 변수 설정 완료:
  - PyTorch 메모리 최적화: ON
  - 병렬 처리: OFF (메모리 절약)
  - 스레드 수: 1 (메모리 절약)
  - Conda 환경: melo
============================================================

============================================================
PDF to MP3 변환 시작
============================================================
입력 파일: 열세번째1.pdf
출력 이름: 열세번째1
시작 번호: 0
디바이스: cpu
============================================================

[1단계] PDF에서 텍스트 추출 중...

[2단계] 텍스트 전처리 및 분할 중...
✓ 총 41개의 청크로 분할되었습니다.

[3단계] 모든 청크를 파일로 저장 중...
✓ 41개의 텍스트 파일 저장 완료
✓ 메모리에서 텍스트 데이터 해제 완료

[4단계] TTS 모델 로딩 중...
⚠️  메모리가 부족한 경우 시간이 걸릴 수 있습니다...
TTS 모델 로딩 완료!

[5단계] MP3 파일 생성 시작 (시작 번호: 0)
============================================================

▶ 처리 중: [1/41] 청크
  - 음성 변환 중...
  ✓ 완료: 열세번째1_00.mp3
...
```

---

## ⚠️ Conda 환경을 활성화하지 않으면?

스크립트가 자동으로 감지하고 안내합니다:

```bash
$ ./run_pdf2mp3.sh 열세번째1.pdf

⚠️  Conda 환경이 활성화되지 않았습니다.
다음 명령으로 먼저 환경을 활성화해주세요:
  conda activate melo

또는 직접 실행:
  python pdf2mp3.py 열세번째1.pdf
```

---

## 🔧 중단 후 이어서 실행

```bash
conda activate melo

# 5번 청크부터 다시 시작 (0부터 시작이므로 6번째 청크)
./run_pdf2mp3.sh 열세번째1.pdf 5
```

---

## 📂 생성되는 파일

### 텍스트 파일 (중간 파일)
```
sptxt_0.txt
sptxt_1.txt
...
sptxt_40.txt
```

### MP3 파일 (최종 결과)
```
열세번째1_00.mp3
열세번째1_01.mp3
...
열세번째1_40.mp3
```

---

## 💡 메모리 사용량 (v2.2)

| 처리 방식 | 메모리 사용 |
|----------|------------|
| 이전 (메모리 보관) | ~900 MB |
| **현재 (파일 기반)** | **~500 MB** ✨ |

**개선**: 41개 청크를 메모리에 보관하지 않고 파일로 저장!

---

## ⚠️ 여전히 "죽었음" 오류 발생 시

### 1. Swap 메모리 추가 (가장 효과적)

```bash
sudo fallocate -l 512M /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
free -h  # 확인
```

### 2. 청크 크기 축소

`pdf2mp3.py` 파일 수정:
```python
def split_text(text, max_length=1500, ...):  # 2000 → 1500
```

---

## 📚 상세 문서

- **HOW_TO_USE.md** - 전체 사용 가이드
- **URGENT_FIX.md** - 긴급 문제 해결
- **MEMORY_OPTIMIZATION.md** - 메모리 최적화 상세

---

## ✨ 체크리스트

- [x] Conda 환경 자동 감지
- [x] 파일 기반 청크 처리 (메모리 절약)
- [x] 메모리 최적화 환경 변수 설정
- [x] 중단 후 재개 가능
- [x] 상세한 진행 상황 표시

---

## 🎉 이제 실행하세요!

```bash
cd ~/work/MeloTTS
git pull origin main
conda activate melo
./run_pdf2mp3.sh 열세번째1.pdf
```

**완료!** 🚀
